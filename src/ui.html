<script>
  onmessage = event => {
    if (event.data.pluginMessage.copiedText) {
      const data = event.data.pluginMessage.copiedText
      let copied = true

      try {
        if (window.copy) {
          window.copy(data)
          console.log('Copied with window.copy')
        } else {
          const area = document.createElement('textarea')
          document.body.appendChild(area)
          area.value = data
          area.focus()
          area.select()
          const result = document.execCommand('copy')
          document.body.removeChild(area)
          if (!result) {
            throw new Error()
          }
          console.log('Copied with document.execCommand')
        }
      } catch (e) {
        console.error(`Unable to copy the value: ${data}`)
        copied = false
      }

      if (copied) {
        // console.log(`Copied the value: ${data}`)
        parent.postMessage(
          { pluginMessage: { type: "shapeGenerated" } },
          "*"
        )
      }
    }
  }
</script>